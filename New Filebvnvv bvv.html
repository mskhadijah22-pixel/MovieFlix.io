<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MovieFlix - A New Experience</title>
    <style>
        /* Google Fonts Import */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/icon?family=Material+Icons');

        :root {
            --netflix-red: #E50914;
            --background-color: #141414;
            --card-color: #1A1A1A;
            --text-color: #FFFFFF;
            --secondary-text-color: #B3B3B3;
            --border-color: #303030;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); }
        header { position: fixed; top: 0; left: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 20px 60px; z-index: 100; background: linear-gradient(to bottom, rgba(0,0,0,0.7) 10%, rgba(0,0,0,0)); transition: background-color 0.3s ease; }
        header.scrolled { background-color: var(--background-color); }
        .logo { font-size: 2rem; font-weight: 700; color: var(--netflix-red); text-decoration: none; }
        .search-container { position: relative; display: flex; align-items: center; }
        .search-container .icon { position: absolute; left: 10px; color: var(--secondary-text-color); }
        #search-input { background-color: rgba(0,0,0,0.5); border: 1px solid var(--border-color); padding: 8px 15px 8px 40px; border-radius: 4px; color: var(--text-color); font-size: 1rem; width: 0; opacity: 0; transition: width 0.4s ease, opacity 0.4s ease; }
        .search-container:hover #search-input, #search-input:focus { width: 250px; opacity: 1; }
        .hero-section { height: 90vh; position: relative; background-size: cover; background-position: center top; transition: background-image 0.5s ease-in-out; }
        .hero-section::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to top, rgba(20,20,20,1) 15%, transparent 50%), linear-gradient(to right, rgba(20,20,20,0.6), transparent 50%); }
        .hero-slider { position: relative; width: 100%; height: 100%; display: flex; align-items: center; padding: 60px; }
        .hero-slide { position: absolute; max-width: 45%; opacity: 0; transition: opacity 0.5s ease-in-out; pointer-events: none; }
        .hero-slide.active { opacity: 1; pointer-events: auto; }
        .hero-title { font-size: 3.5rem; font-weight: 700; margin-bottom: 20px; }
        .hero-button { padding: 12px 30px; font-size: 1.2rem; font-weight: 600; border-radius: 5px; border: none; background-color: var(--netflix-red); color: var(--text-color); cursor: pointer; transition: background-color 0.3s ease; }
        .slider-dots { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; z-index: 50; }
        .dot { width: 10px; height: 10px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.4); cursor: pointer; transition: background-color 0.3s ease; }
        .dot.active { background-color: var(--text-color); }
        .movies-section { padding: 0 60px 40px; margin-top: -80px; position: relative; z-index: 20; }
        .category-row { margin-bottom: 40px; }
        .category-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 15px; }
        .movie-carousel { display: flex; overflow-x: auto; overflow-y: hidden; padding-bottom: 20px; gap: 15px; scrollbar-width: thin; scrollbar-color: var(--border-color) transparent; }
        .movie-carousel::-webkit-scrollbar { height: 8px; }
        .movie-carousel::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 4px; }
        .movie-card { flex: 0 0 180px; width: 180px; border-radius: 5px; overflow: hidden; cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .movie-card:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .movie-card img { width: 100%; height: 260px; object-fit: cover; display: block; }
        #status-message { font-size: 1.5rem; text-align: center; padding: 50px; }
        .modal { display: none; position: fixed; z-index: 1100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); justify-content: center; align-items: center; }
        .modal-content { background-color: var(--card-color); padding: 25px; border-radius: 8px; width: 85%; max-width: 950px; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 25px; font-size: 35px; font-weight: bold; color: #aaa; cursor: pointer; }
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; margin-bottom: 20px; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #modal-movie-title { font-size: 2rem; margin-bottom: 10px; }
        #modal-movie-category { font-size: 1.1rem; color: var(--secondary-text-color); margin-bottom: 20px; }
        
        /* Your Popup Styles */
        #Popup_Back.modal{display:none;position:fixed;top:0;right:0;bottom:0;left:0;text-align:left;background:rgba(0,0,0,.9);transition:opacity .25s ease;z-index:9999}.Popup_button{cursor:pointer}.Popup_bg{position:absolute;top:0;right:0;bottom:0;left:0;cursor:pointer}.Popup_inner{transition:top .25s ease;position:relative;top:0;width:50%;margin:auto;overflow:auto;background:#ffffff;border-radius:5px;padding:1em 2em;color:black;}.pop__close{position:absolute;right:1em;top:1em;width:1.1em;height:1.1em;cursor:pointer}@media screen and (max-width:768px){.Popup_inner{width:90%;height:auto;box-sizing:border-box}}.pop-heading{height:40px;width:100%;border-bottom:1px #e5e5e5 solid;display:flex;align-items:center;}.adhtml{margin:14px 0 4px;min-height:260px}.popup_ad_container{height:auto; min-height: 260px;}#K_download{display:inline-block;height:45px;line-height:28px;width:180px;text-align:center;background-color:#FF0000;color:#fff;padding:8px;font-size:19px;border-radius:1px;text-decoration:none;margin-top:1px}.pop_final_btn{line-height:16px;margin:15px;font-size:19px;text-align:center;position:relative}.Popup_button{display:inline-block; height:45px; color:#fff;font-size:16px;font-weight:600; background: #2f81ed;text-align:center;line-height:45px;width:150px;border-radius: 5px; margin-top: 10px; transition:all .4s ease-in;cursor:pointer;}.pop-heading h2{margin:0}
    </style>
</head>
<body>

    <header id="main-header">
        <a href="#" class="logo">MovieFlix</a>
        <div class="search-container">
            <i class="material-icons icon">search</i>
            <input type="text" id="search-input" placeholder="Titles, genres...">
        </div>
    </header>
       <!-- Your Ad script can go here -->
<<script type="text/javascript">
    atOptions = {
        'key' : '9d7d9927e3391933ab7cdf8ab1d72504',
        'format' : 'iframe',
        'height' : 50,
        'width' : 320,
        'params' : {}
    };
</script>
<script type="text/javascript" src="//accountantflowerrespiration.com/9d7d9927e3391933ab7cdf8ab1d72504/invoke.js"></script>

    <main>
        <section id="hero-section" class="hero-section">
            <div id="hero-slider" class="hero-slider"></div>
            <div id="slider-dots" class="slider-dots"></div>
        </section>

        <section class="movies-section">
            <div id="category-rows"></div>
            <p id="status-message">Loading movies...</p>
        </section>
    </main>
    
    <!-- Movie Player Modal -->
    <div id="movie-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="video-container">
                <iframe id="movie-player" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
            <h2 id="modal-movie-title"></h2>
            <p id="modal-movie-category"></p>
            <!-- Your New Download Button -->
            <div class="Popup_button" id="Popup_button">Download</div>
        </div>
    </div>

    <!-- Your Download Popup Modal -->
    <div class="modal" id="Popup_Back">
        <div class="Popup_bg pop_btnclose"></div>
        <div class="Popup_inner">
            <div class="pop-heading">
                 <h2 style="margin: 0px;">Download Your file</h2>
                 <label class="pop__close pop_btnclose"><svg style="height: 25px; width: 25px; fill: black;" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M278.6 256l68.2-68.2c6.2-6.2 6.2-16.4 0-22.6-6.2-6.2-16.4-6.2-22.6 0L256 233.4l-68.2-68.2c-6.2-6.2-16.4-6.2-22.6 0-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3l68.2 68.2-68.2 68.2c-3.1 3.1-4.7 7.2-4.7 11.3 0 4.1 1.6 8.2 4.7 11.3 6.2 6.2 16.4 6.2 22.6 0l68.2-68.2 68.2 68.2c6.2 6.2 16.4 6.2 22.6 0 6.2-6.2 6.2-16.4 0-22.6L278.6 256z"></path></svg></label>
            </div>
            <div class="popup_ad_container">
                <div class="adhtml">
                    <!-- Your Ad script can go here -->
                    <script type="text/javascript">
                        atOptions = {
                            'key' : '0a58b4f02b9aeb6c73330b77ba08a5ef',
                            'format' : 'iframe',
                            'height' : 250,
                            'width' : 300,
                            'params' : {}
                        };
                    </script>
                    <script type="text/javascript" src="//accountantflowerrespiration.com/0a58b4f02b9aeb6c73330b77ba08a5ef/invoke.js"></script>
                </div>
            </div>
             <div class="pop_final_btn">
                <a class="button" download="" href="#" id="K_download">Download File</a>
             </div>
        </div>
    </div>

    <!-- Main Firebase Module Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase configuration...
        const firebaseConfig = {
          apiKey: "AIzaSyC8IsKZeXu-qn8t6nys3UwCEr88qcM-MAo",
          authDomain: "movie-download-4565d.firebaseapp.com",
          projectId: "movie-download-4565d",
          storageBucket: "movie-download-4565d.firebasestorage.app",
          messagingSenderId: "239894393517",
          appId: "1:239894393517:web:d2855f1927368611c2cc24",
          measurementId: "G-YZSWTM80D3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // ... (All other DOM elements and functions for slider, movie rows, etc. remain the same)
        const categoryRowsContainer = document.getElementById('category-rows');
        const statusMessage = document.getElementById('status-message');
        const searchInput = document.getElementById('search-input');
        const heroSection = document.getElementById('hero-section');
        const heroSlider = document.getElementById('hero-slider');
        const sliderDotsContainer = document.getElementById('slider-dots');
        const modal = document.getElementById('movie-modal');
        const modalCloseBtn = modal.querySelector('.close-btn');
        const modalMovieTitle = document.getElementById('modal-movie-title');
        const modalMovieCategory = document.getElementById('modal-movie-category');
        const moviePlayer = document.getElementById('movie-player');
        
        let allMovies = [];
        let heroMovies = [];
        let currentSlideIndex = 0;
        let slideInterval;

        function setupHeroSlider() {
            heroSlider.innerHTML = '';
            sliderDotsContainer.innerHTML = '';
            heroMovies.forEach((movie, index) => {
                const slide = document.createElement('div');
                slide.className = 'hero-slide';
                slide.innerHTML = `<h2 class="hero-title">${movie.title}</h2><button class="hero-button" data-id="${movie.id}">Watch Now</button>`;
                heroSlider.appendChild(slide);
                const dot = document.createElement('span');
                dot.className = 'dot';
                dot.dataset.index = index;
                sliderDotsContainer.appendChild(dot);
            });
            showSlide(0);
            startSliderInterval();
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('.hero-slide');
            const dots = document.querySelectorAll('.dot');
            const movie = heroMovies[index];
            if (!movie) return;
            heroSection.style.backgroundImage = `url(${movie.posterUrl})`;
            slides.forEach(slide => slide.classList.remove('active'));
            slides[index].classList.add('active');
            dots.forEach(dot => dot.classList.remove('active'));
            dots[index].classList.add('active');
            currentSlideIndex = index;
        }

        function startSliderInterval() {
            clearInterval(slideInterval);
            slideInterval = setInterval(() => {
                const nextIndex = (currentSlideIndex + 1) % heroMovies.length;
                showSlide(nextIndex);
            }, 5000);
        }

        sliderDotsContainer.addEventListener('click', (e) => {
            if (e.target.classList.contains('dot')) {
                const index = parseInt(e.target.dataset.index);
                showSlide(index);
                startSliderInterval();
            }
        });
        
        function displayMovieRows(moviesToDisplay) {
            categoryRowsContainer.innerHTML = '';
            if (moviesToDisplay.length === 0) {
                statusMessage.textContent = 'No movies found.';
                statusMessage.style.display = 'block';
                return;
            }
            statusMessage.style.display = 'none';
            const moviesByCategory = moviesToDisplay.reduce((acc, movie) => {
                const category = movie.category || 'Uncategorized';
                if (!acc[category]) acc[category] = [];
                acc[category].push(movie);
                return acc;
            }, {});
            for (const category in moviesByCategory) {
                const row = document.createElement('div');
                row.className = 'category-row';
                const title = document.createElement('h3');
                title.className = 'category-title';
                title.textContent = category;
                const carousel = document.createElement('div');
                carousel.className = 'movie-carousel';
                moviesByCategory[category].forEach(movie => {
                    const card = document.createElement('div');
                    card.className = 'movie-card';
                    card.dataset.id = movie.id;
                    card.innerHTML = `<img src="${movie.posterUrl}" alt="${movie.title}">`;
                    carousel.appendChild(card);
                });
                row.appendChild(title);
                row.appendChild(carousel);
                categoryRowsContainer.appendChild(row);
            }
        }
        
        async function fetchMovies() {
            try {
                const querySnapshot = await getDocs(collection(db, "movies"));
                allMovies = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (allMovies.length > 0) {
                    heroMovies = allMovies.slice(0, 5);
                    setupHeroSlider();
                    displayMovieRows(allMovies);
                } else {
                     statusMessage.textContent = 'No movies available at the moment.';
                     heroSection.style.display = 'none';
                }
            } catch (error) {
                console.error("Error fetching movies: ", error);
                statusMessage.textContent = 'Failed to load movies.';
            }
        }
        
        searchInput.addEventListener('input', () => {
            clearInterval(slideInterval);
            const searchTerm = searchInput.value.toLowerCase();
            heroSection.style.display = searchTerm === "" ? 'block' : 'none';
            if (searchTerm === "") startSliderInterval();
            const filteredMovies = allMovies.filter(movie => 
                movie.title.toLowerCase().includes(searchTerm) ||
                movie.category.toLowerCase().includes(searchTerm)
            );
            displayMovieRows(filteredMovies);
        });

        // MODIFIED MODAL FUNCTION
        function openModal(movie) {
            modalMovieTitle.textContent = movie.title;
            modalMovieCategory.textContent = `Category: ${movie.category}`;
            let videoUrl = movie.videoUrl.replace("watch?v=", "embed/");
            moviePlayer.src = videoUrl;
            
            // Set the download link for the NEW popup modal
            const finalDownloadLink = document.getElementById('K_download');
            if (finalDownloadLink) {
                finalDownloadLink.href = movie.downloadUrl;
            }
            
            modal.style.display = 'flex';
        }
        
        function closeModal() {
            modal.style.display = 'none';
            moviePlayer.src = '';
        }

        document.body.addEventListener('click', (e) => {
            const card = e.target.closest('.movie-card, .hero-button');
            if (card) {
                const movieId = card.dataset.id;
                const movieData = allMovies.find(m => m.id === movieId);
                if (movieData) openModal(movieData);
            }
        });

        modalCloseBtn.addEventListener('click', closeModal);
        window.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        window.addEventListener('scroll', () => {
            const header = document.getElementById('main-header');
            header.classList.toggle('scrolled', window.scrollY > 50);
        });

        fetchMovies();
    </script>
    
    <!-- Your Popup Logic Script -->
    <script>
        //<![CDATA[
        const popupModal = document.querySelector("#Popup_Back");
        const openPopupBtns = document.querySelectorAll(".Popup_button");
        const closePopupBtns = document.querySelectorAll(".pop_btnclose");

        let countdownInterval;

        function startCountdown() {
            var downloadButton = document.getElementById("K_download");
            if (!downloadButton) return;

            var counter = 15;
            var newElement = document.createElement("span");
            newElement.innerHTML = "Please Wait 15 sec";
            newElement.style.font = '16px';
            
            downloadButton.parentNode.replaceChild(newElement, downloadButton);

            countdownInterval = setInterval(function() {
                counter--;
                if (counter < 0) {
                    newElement.parentNode.replaceChild(downloadButton, newElement);
                    clearInterval(countdownInterval);
                } else {
                    newElement.innerHTML = "Please Wait " + counter.toString() + " sec....";
                }
            }, 1000);
        }
        
        // Open popup
        document.body.addEventListener('click', function(event) {
            if (event.target.matches('.Popup_button')) {
                popupModal.style.display = "block";
                startCountdown();
            }
        });
        
        // Close popup
        closePopupBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                popupModal.style.display = "none";
                clearInterval(countdownInterval); // Stop timer if popup is closed early
            });
        });
        
        //]]>
    </script>
       <!-- Your Ad script can go here -->

<script type='text/javascript' src='//accountantflowerrespiration.com/31/0b/50/310b508fc5771984195db5013cccce81.js'></script>

</body>
</html>